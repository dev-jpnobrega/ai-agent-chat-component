import{r as e,c as t,h as s}from"./p-1d6ea7ff.js";class a extends Error{constructor(e){const t=e.cause?e.cause:e;let{message:s,code:a}=t;if(e.name==="AbortError"){s="Request timeout";a="ETIMEDOUT"}super(s);this.name=t.name;this.code=a;this.originalStack=t.stack}}function n({timeout:e,abortController:t=new AbortController}){let s=null;const{signal:a}=t;if(e){s=setTimeout((()=>{t.abort()}),e)}return{signal:a,timeoutId:s}}function i(e){try{return JSON.parse(e)}catch(t){return e}}async function o(e,t){const s=t?e.body:i(await e.text());const a={};Array.from(e.headers.keys()).forEach((t=>{a[t]=e.headers.get(t)}));const n={body:s,response:{body:s,headers:a,ok:e.ok,statusCode:e.status,statusText:e.statusText}};return e.ok?n:Promise.reject(n)}async function r(e={},t=false){try{const s=n(e);const a=Object.assign({"Content-Type":"application/json"},e.headers);const i=new URL(e.uri);const{params:r={}}=e;Object.keys(r).forEach((e=>{i.searchParams.append(e,r[e])}));const d=await fetch(i,Object.assign(Object.assign({},e),{body:JSON.stringify(e.body),headers:a,signal:s.signal}));clearTimeout(s.timeoutId);return o(d,t)}catch(e){const t=new a(e);console.error({details:t,error:t.name,message:`[COMMONS-FETCH-REQUEST]-ERROR: ${t.name} - ${t.message}`});throw t}}class d{constructor(e){this.settings=e}async getAgent(e){try{const t=await r({method:`GET`,headers:{"x-api-key":this.settings.xApiKey},uri:`${this.settings.url}/workout/v1/agent/${e}`});return t.body}catch(e){console.error(e)}}async sendMessage(e){try{const t=await r({method:`POST`,uri:`${this.settings.url}/workout/v1/chat`,body:{body:Object.assign({},e)}});return t.body}catch(e){console.error(e)}}}const l={"button.send":"Send","text.placeholder":"Type your message here..."};const c={"button.send":"Enviar","text.placeholder":"Digite uma mensagem..."};const g={en:l,"pt-br":c};class p{static async fetchTranslations(e=`en`){const t=JSON.parse(sessionStorage.getItem(`i18n.${e}`));if(t&&Object.keys(t).length>0){return t}try{const t=g[e];sessionStorage.setItem(`i18n.${e}`,JSON.stringify(t));return t}catch(t){console.error(`Error loading locale: ${e}`,t);return undefined}}}function h(){return Math.random().toString(36).substring(7)}const m='*,*::before,*::after{box-sizing:border-box}html,body{height:100%;margin:0}body{background:linear-gradient(135deg, #044f48, #2a7561);background-size:cover;font-family:"Segoe UI, Helvetica Neue, Helvetica, Lucida Grande, Arial, Ubuntu, Cantarell, Fira Sans", sans-serif;font-size:12px;line-height:1.3;overflow:hidden}.bg{width:100%;height:100%;top:0;left:0;z-index:1;filter:blur(80px);transform:scale(1.2)}.chat{font-family:"Segoe UI, Helvetica Neue, Helvetica, Lucida Grande, Arial, Ubuntu, Cantarell, Fira Sans", sans-serif;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);min-height:100%;min-width:100%;overflow:hidden;box-shadow:0 5px 30px rgba(0, 0, 0, 0.2);background:url("https://cloudfronttestebucket.s3.amazonaws.com/bg.png") repeat 0 0;border-radius:20px;display:flex;justify-content:space-between;flex-direction:column}.chat-title{flex:0 1 45px;position:relative;z-index:2;background:#F0F2F5;color:#000;text-align:left;padding:15px 10px 10px 67px;margin-bottom:10px}.chat-title h1,.chat-title h2{font-weight:normal;font-size:15px;margin:0;padding:1px}.chat-title h2{color:rgb(99, 95, 95);font-size:13px;margin-top:1px}.chat-title .avatar{position:absolute;z-index:1;top:8px;left:9px;border-radius:30px;width:50px;height:50px;overflow:hidden;margin:0;padding:0;border:2px solid rgba(255, 255, 255, 0.24)}.chat-title .avatar img{width:100%;height:100%}.messages{flex:1 1 auto;overflow:auto;position:relative;width:100%}.messages .messages-content{position:absolute;top:0;left:0;height:101%;width:100%}.messages .message{clear:both;float:left;padding:6px 10px 7px;border-radius:10px 10px 10px 0;background:rgb(255, 255, 255);margin:8px 0;font-size:11px;line-height:1.4;margin-left:35px;position:relative}.messages .message .timestamp{float:right;align-content:end;bottom:-15px;font-size:9px;z-index:3;color:rgba(2, 2, 2, 0.3)}.messages .message::before{content:"";position:absolute;bottom:-6px;border-top:6px solid rgb(255, 255, 255);left:0;border-right:7px solid transparent}.messages .message .avatar{position:absolute;z-index:1;bottom:-15px;left:-35px;border-radius:30px;width:30px;height:30px;overflow:hidden;margin:0;padding:0}.messages .message .avatar img{width:100%;height:90%}.messages .message.message-personal{float:right;text-align:right;background:linear-gradient(120deg, #E1F6CA, #E1F6CA);border-radius:10px 10px 0 10px}.messages .message.message-personal::before{left:auto;right:0;border-right:none;border-left:5px solid transparent;border-top:4px solid #E1F6CA;bottom:-4px}.messages .message:last-child{margin-bottom:30px}.messages .message.new{transform:scale(0);transform-origin:0 0;animation:bounce 500ms linear both}.messages .message.loading::before{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);content:"";display:block;width:3px;height:3px;border-radius:50%;background:rgba(0, 0, 0, 0.5);z-index:2;margin-top:4px;animation:ball 0.45s cubic-bezier(0, 0, 0.15, 1) alternate infinite;border:none;animation-delay:0.15s}.messages .message.loading span{display:block;font-size:0;width:20px;height:10px;position:relative}.messages .message.loading span::before{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);content:"";display:block;width:3px;height:3px;border-radius:50%;background:rgba(0, 0, 0, 0.5);z-index:2;margin-top:4px;animation:ball 0.45s cubic-bezier(0, 0, 0.15, 1) alternate infinite;margin-left:-7px}.messages .message.loading span::after{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);content:"";display:block;width:3px;height:3px;border-radius:50%;background:rgba(0, 0, 0, 0.5);z-index:2;margin-top:4px;animation:ball 0.45s cubic-bezier(0, 0, 0.15, 1) alternate infinite;margin-left:7px;animation-delay:0.3s}.message-box{flex:0 1 40px;width:100%;background:#F0F2F5;padding:10px;position:relative}.message-box .message-input{background:none;border:none;outline:none !important;resize:none;color:rgb(12, 12, 12);font-size:11px;height:17px;margin:0;padding-right:20px;width:265px}.message-box textarea:focus:-webkit-placeholder{color:transparent}.message-box .message-submit{position:absolute;z-index:1;top:9px;right:10px;color:#fff;border:none;background:#248A52;font-size:10px;text-transform:uppercase;line-height:1;padding:6px 10px;border-radius:10px;outline:none !important;transition:background 0.2s ease}.message-box .message-submit:hover{background:#1D7745}.message-box .message-submit:disabled{position:absolute;z-index:1;top:9px;right:10px;color:#fff;border:none;background:#CCCCCC;font-size:10px;text-transform:uppercase;line-height:1;padding:6px 10px;border-radius:10px}::-webkit-scrollbar{width:0.3em;opacity:0}::-webkit-scrollbar-track{box-shadow:inset 0 0 5px #F0F2F5;opacity:0}::-webkit-scrollbar-thumb{background-color:rgba(192, 185, 185, 0.5) !important;opacity:0}::-webkit-scrollbar-thumb:hover{background-color:rgba(192, 185, 185, 0.5) !important;margin:1px -3px 1px 0;opacity:0}.mCSB_scrollTools{margin:1px -3px 1px 0;opacity:0}.mCSB_inside>.mCSB_container{margin-right:0px;padding:0 10px}.mCSB_scrollTools .mCSB_dragger .mCSB_dragger_bar{background-color:rgba(192, 185, 185, 0.5) !important}@keyframes bounce{0%{transform:matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}4.7%{transform:matrix3d(0.45, 0, 0, 0, 0, 0.45, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}9.41%{transform:matrix3d(0.883, 0, 0, 0, 0, 0.883, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}14.11%{transform:matrix3d(1.141, 0, 0, 0, 0, 1.141, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}18.72%{transform:matrix3d(1.212, 0, 0, 0, 0, 1.212, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}24.32%{transform:matrix3d(1.151, 0, 0, 0, 0, 1.151, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}29.93%{transform:matrix3d(1.048, 0, 0, 0, 0, 1.048, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}35.54%{transform:matrix3d(0.979, 0, 0, 0, 0, 0.979, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}41.04%{transform:matrix3d(0.961, 0, 0, 0, 0, 0.961, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}52.15%{transform:matrix3d(0.991, 0, 0, 0, 0, 0.991, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}63.26%{transform:matrix3d(1.007, 0, 0, 0, 0, 1.007, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}85.49%{transform:matrix3d(0.999, 0, 0, 0, 0, 0.999, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}100%{transform:matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)}}@keyframes ball{from{transform:translateY(0) scaleY(0.8)}to{transform:translateY(-10px)}}';const b=m;const f=({agent:e,content:t,date:a,sender:n,loading:i})=>{const o=a.getHours()+":"+a.getMinutes();const r=e=>{var t;return s("div",{class:"message message-personal new"},s("div",{innerHTML:((t=e.content)===null||t===void 0?void 0:t.replace(/(?:\r\n|\r|\n)/g,"<br>"))||""},s("span",null)),s("div",{class:"timestamp"},o))};const d=t=>{var a;return s("div",{class:`message ${!t.loading||`loading`} new`},s("figure",{class:"avatar"},s("img",{src:(e===null||e===void 0?void 0:e.urlImg)||"https://cloudfronttestebucket.s3.amazonaws.com/agent.jpg"})),s("div",{innerHTML:((a=t.content)===null||a===void 0?void 0:a.replace(/(?:\r\n|\r|\n)/g,"<br>"))||""},s("span",null)),s("div",{class:"timestamp"},o))};return n===`AI`?d({agent:e,content:t,date:a,sender:n,loading:i}):r({agent:e,content:t,date:a,sender:n,loading:i})};const u=({agent:e,messages:t})=>s("div",{class:"messages-content"},t.map((t=>s(f,{agent:e,content:t.content,date:t.date,sender:t.sender,loading:t.loading}))));const x=new d({url:"https://ai-enterprise-api.azurewebsites.net",xApiKey:"my-key"});const v=class{constructor(a){e(this,a);this.send=t(this,"send",7);this.receiver=t(this,"receiver",7);this.renderMessages=e=>s(u,{messages:e,agent:this.Agent});this.messagesContainer=null;this.greetings=undefined;this.identifier=undefined;this.chatUid=undefined;this.context=undefined;this.language=undefined;this.translations=undefined;this.messages=[];this.content="";this.disableSend=true;this.Agent=undefined}async componentWillLoad(){var e;this.chatUid=this.chatUid||h();const t=h();this.translations=await p.fetchTranslations(this.language);const s={id:this.chatUid,agentUid:this.identifier,userId:this.chatUid,context:this.context||"",messages:[{id:t,content:this.greetings||"Hi"}]};this.receiver.emit({id:t,content:undefined,date:new Date,loading:true,sender:"AI"});if(!((e=this.Agent)===null||e===void 0?void 0:e.name)){this.Agent=await x.getAgent(this.identifier)}console.warn("this.Agent",this.Agent);const a=await x.sendMessage(s);this.receiver.emit({id:t,content:a,date:new Date,loading:false,sender:"AI"});this.disableSend=false}componentDidRender(){this.onScroll(null)}sendHandler(e){const t=e.detail;this.disableSend=true;this.receiver.emit(Object.assign({},t));const s=h();this.receiver.emit({id:s,date:new Date,loading:true,sender:"AI"});const a={id:this.chatUid,agentUid:this.identifier,userId:this.chatUid,context:this.context||"",messages:[Object.assign({id:s},t)]};x.sendMessage(a).then((e=>{this.receiver.emit({id:s,content:e,date:new Date,loading:false,sender:"AI"});this.disableSend=false})).catch((e=>{console.error(e)}))}receiverHandler(e){const t=e.detail;this.messages=[...this.messages.filter((e=>e.id!==t.id)),t]}handleKeyDown(e){if(e.key==="Enter"&&!this.disableSend){this.handleSend(e)}}handleSend(e){e.preventDefault();if(!this.content)return;this.send.emit({id:h(),content:this.content,date:new Date,loading:false,sender:"USER"});this.content=""}handleChange(e){this.content=e.target.value}onScroll(e){if(this.messagesContainer){this.messagesContainer.scrollTo({top:this.messagesContainer.scrollHeight,behavior:"smooth"})}}render(){var e,t,a;return s("div",{key:"5767051ba35dc253abb4fcddc823504d4bb121f1",class:"chat"},s("div",{key:"4e6938a3b34a7f99699c89ad482848a043126ac2",class:"chat-title"},s("h1",{key:"527d2e6b84731a08def40feb7d22080c174f38cb"},((e=this.Agent)===null||e===void 0?void 0:e.name)||"BOT"),s("h2",{key:"2d717b708c5025ef594103f9d93cadfb327165ea"},((t=this.Agent)===null||t===void 0?void 0:t.description)||"IA Assistent"),s("figure",{key:"38e433ae5fa191e97ad30f6acc8ea5bb9e08bf3d",class:"avatar"},s("img",{key:"7ae5d70225b82709ac6467287a065edb06feb5fc",src:((a=this.Agent)===null||a===void 0?void 0:a.urlImg)||"https://cloudfronttestebucket.s3.amazonaws.com/agent.jpg"}))),s("div",{key:"6141421b8969d9289b10e04ce11a63a1b53e264a",class:"messages",ref:e=>this.messagesContainer=e},this.renderMessages(this.messages)),s("div",{key:"e604ee4064078e11a02d3f240518b0019bafc3f5",class:"message-box"},s("textarea",{key:"035db22a7f0e1c85fda9691f78e2cb4dea7d6c61",typeof:"text",value:this.content,onInput:e=>this.handleChange(e),class:"message-input",placeholder:this.translations?this.translations["text.placeholder"]:"Digite sua mensagem ..."}),s("button",{key:"850f9be236724ccf3ee51afc060a60d7ff949ec5",disabled:this.disableSend,type:"submit",class:"message-submit",onClick:e=>this.handleSend(e)},this.translations?this.translations["button.send"]:"Enviar")))}};v.style=b;export{v as chat_component};
//# sourceMappingURL=p-c79b18b7.entry.js.map